{% extends 'layouts/base.html' %}

{% block title %} {{ video.title }} - Stream Video {% endblock %}

{% block stylesheets %}
{{ block.super }}
<style>
    /* Video Stream Section */
    .video-stream-section {
        padding: 40px 20px;
        background-color: #f9f9f9;
    }
    .video-container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }
    .video-details {
        margin-top: 20px;
    }
</style>
{% endblock stylesheets %}

{% block content %}
<!-- Video Stream Section -->
<div class="video-stream-section">
    <div class="container">
        <h1>{{ video.title }}</h1>
        <p>Remaining Views: {{ access.access_count }}</p>

        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        {% if access.access_count > 0 %}
        <div class="video-container">
            <!-- Video.js Player -->
            <video id="videoPlayer" class="video-js vjs-default-skin" controls width="800" height="450" controlsList="nodownload" oncontextmenu="return false;">
                <source src="{{ presigned_url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>            
            <!-- Video Details -->
            <div class="video-details">
                <h2>Video Details</h2>
                <p>{{ video.description }}</p>
            </div>

            <!-- Back to Course Link -->
            <a href="{% url 'course_videos' video.course.id %}" class="back-link">&larr; Back to Course</a>
        </div>
        {% else %}
        <p style="text-align: center; font-size: 18px; color: #666;">
            You have no remaining views for this video.
        </p>
        {% endif %}
    </div>
</div>

<!-- Video.js Initialization -->
<script>
    var player = videojs('videoPlayer', {
        controls: true,
        autoplay: true,
        preload: 'auto'
    });
</script>

{% endblock %}
